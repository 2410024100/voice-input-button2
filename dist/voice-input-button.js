!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("VoiceInputButton",[],e):"object"==typeof exports?exports.VoiceInputButton=e():t.VoiceInputButton=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s=10)}([function(t,e){function n(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var a=r(i);return[n].concat(i.sources.map(function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"})).concat([a]).join("\n")}return[n].join("\n")}function r(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var r=n(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var a=this[i][0];"number"==typeof a&&(r[a]=!0)}for(i=0;i<t.length;i++){var o=t[i];"number"==typeof o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),e.push(o))}},e}},function(t,e,n){function r(t){for(var e=0;e<t.length;e++){var n=t[e],r=d[n.id];if(r){r.refs++;for(var i=0;i<r.parts.length;i++)r.parts[i](n.parts[i]);for(;i<n.parts.length;i++)r.parts.push(a(n.parts[i]));r.parts.length>n.parts.length&&(r.parts.length=n.parts.length)}else{for(var o=[],i=0;i<n.parts.length;i++)o.push(a(n.parts[i]));d[n.id]={id:n.id,refs:1,parts:o}}}}function i(){var t=document.createElement("style");return t.type="text/css",l.appendChild(t),t}function a(t){var e,n,r=document.querySelector("style["+m+'~="'+t.id+'"]');if(r){if(h)return g;r.parentNode.removeChild(r)}if(y){var a=f++;r=p||(p=i()),e=o.bind(null,r,a,!1),n=o.bind(null,r,a,!0)}else r=i(),e=s.bind(null,r),n=function(){r.parentNode.removeChild(r)};return e(t),function(r){if(r){if(r.css===t.css&&r.media===t.media&&r.sourceMap===t.sourceMap)return;e(t=r)}else n()}}function o(t,e,n,r){var i=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=w(e,i);else{var a=document.createTextNode(i),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(a,o[e]):t.appendChild(a)}}function s(t,e){var n=e.css,r=e.media,i=e.sourceMap;if(r&&t.setAttribute("media",r),v.ssrId&&t.setAttribute(m,e.id),i&&(n+="\n/*# sourceURL="+i.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var c="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!c)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var u=n(14),d={},l=c&&(document.head||document.getElementsByTagName("head")[0]),p=null,f=0,h=!1,g=function(){},v=null,m="data-vue-ssr-id",y="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());t.exports=function(t,e,n,i){h=n,v=i||{};var a=u(t,e);return r(a),function(e){for(var n=[],i=0;i<a.length;i++){var o=a[i],s=d[o.id];s.refs--,n.push(s)}e?(a=u(t,e),r(a)):a=[];for(var i=0;i<n.length;i++){var s=n[i];if(0===s.refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete d[s.id]}}}};var w=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t,e,n,r,i,a){var o,s=t=t||{},c=typeof t.default;"object"!==c&&"function"!==c||(o=t,s=t.default);var u="function"==typeof s?s.options:s;e&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0),n&&(u.functional=!0),i&&(u._scopeId=i);var d;if(a?(d=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},u._ssrRegister=d):r&&(d=r),d){var l=u.functional,p=l?u.render:u.beforeCreate;l?(u._injectStyles=d,u.render=function(t,e){return d.call(e),p(t,e)}):u.beforeCreate=p?[].concat(p,d):[d]}return{esModule:o,exports:s,options:u}}},function(t,e,n){"use strict";var r=n(4),i=n.n(r),a=n(15),o=n(19),s=n(23),c=n(27),u=n(31),d=function(){function t(t,e){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!e||n.length!==e);r=!0);}catch(t){i=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(t,e){Object.defineProperty(t,e,{configurable:!1})},p=[];e.a={name:"voice-input-button",components:{loading:o.a,recordingIcon:s.a,microphone:c.a,recordingTip:u.a},props:{color:{type:String,default:"#333"},tipPosition:String,appId:String,apiKey:String,apiSecret:String,interactiveMode:{type:String,default:"press"},returnMode:{type:String,defualt:"increment"},language:{type:String,default:"zh_cn"},accent:String,pd:String,rlang:String,ptt:Number,nunum:Number,vad_eos:{type:Number,default:3e3}},data:function(){return{recorder:null,processing:!1,startTime:0,time:0,timer:null,recording:!1,inputTarget:null,isAudioAvailable:!1,blank:!1,resultCache:{},result:"",responding:!1}},methods:{menuPop:function(){return window.event.returnValue=!1,!1},toggle:function(t){this.recording?this.stop(t):this.start(t)},start:function(t){var e=this;if(t.preventDefault(),!this.isAudioAvailable)return void alert(this.locale.not_supported);this.recording||1!==t.which&&0!==t.which||(this.reset(),this.recording=!0,this.startTime=(new Date).getTime(),this.timer=setInterval(function(){e.time=(new Date).getTime()-e.startTime},20),this.recorder.start(),this.$emit("record-start"))},stop:function(t){t&&t.preventDefault(),!this.recording||t&&1!==t.which&&0!==t.which||(this.recording=!1,this.timer&&clearInterval(this.timer),this.time=0,this.$emit("record-stop"),this.processing=!0,this.recorder.stop())},reset:function(){var t=this;p.splice(0),this.resultCache={},this.responding=!1,setTimeout(function(){t.result=""},500)},appendResult:function(t,e){this.resultCache[e]={text:t}},replaceResult:function(t,e,n,r){this.appendResult(t,e);for(var i=this.resultCache,a=n;a<=r;a++)i[a].discarded=!0},getResult:function(){return Object.values(this.resultCache).filter(function(t){return!t.discarded}).map(function(t){return t.text}).join("")},setResult:function(t){var e=this;this.responding=!0;for(var n="",r=t.ws,i=0;i<r.length;i++)n+=r[i].cw[0].w;var a=t.pgs,o=t.sn,s=t.ls;if(a)if("apd"===a)this.appendResult(n,o);else{var c=d(t.rg,2),u=c[0],l=c[1];this.replaceResult(n,o,u,l)}else this.appendResult(n,o);var p=this.getResult();this.result=p,this.completeMode&&!s||(s&&this.reset(),p?(this.$emit("record",p),this.$emit("input",p)):(this.$emit("record-blank"),this.blank=!0,setTimeout(function(){e.blank=!1},1e3)))}},computed:{pressMode:function(){return"touch"!==this.interactiveMode},touchMode:function(){return"touch"===this.interactiveMode},incrementMode:function(){return"increment"===this.returnMode},completeMode:function(){return"complete"===this.returnMode},locale:function(){return i.a[(this.IATConfig||{}).language||this.language]},state:function(){return this.recorder?this.recorder.state:"end"}},created:function(){var t=this,e=this.IATConfig||{},n=new a.a({onClose:function(){t.stop(),t.processing=!1},onError:function(){t.stop(),t.reset(),t.processing=!1,t.$emit("record-failed",error),alert(t.locale.socket_error)},onMessage:function(e){var n=JSON.parse(e.data);n.data&&n.data.result&&t.setResult(n.data.result)},onStart:function(){},appId:e.appId||this.appId,apiKey:e.apiKey||this.apiKey,apiSecret:e.apiSecret||this.apiSecret,accent:e.accent||this.accent,language:e.language||this.language,pd:e.pd||this.pd,rlang:e.rlang||this.rlang,ptt:e.ptt||this.ptt,nunum:e.nunum||this.nunum,vad_eos:e.vad_eos||this.vad_eos});["appId","apiSecret","apiKey","accent","language","pd","rlang","ptt","nunum","vad_eos","config"].forEach(function(t){l(n,t)}),this.recorder=n,this.isAudioAvailable=this.recorder.isAudioAvailable},beforeDestroy:function(){this.recorder.stop(),this.recorder=null}}},function(t,e){t.exports={zh_cn:{wait:"请稍后…",recording:"好，请讲…",say_nothing:"您好像没说什么",not_supported:"无法录音：未找到录音设备、当前浏览器不支持录音或用户未授权！",socket_error:"WebSocket连接失败",access_microphone_failed:"请求麦克风失败"},en_us:{wait:"Please wait…",recording:"Recording…",say_nothing:"You don't seem to say anything",not_supported:"Unable to record: No recording device was found, the current browser does not support recording, or the user is not authorized!",socket_error:"socket connect failed",access_microphone_failed:"access microphone failed"}}},function(t,e,n){"use strict";var r=r||function(t,e){var n={},r=n.lib={},i=function(){},a=r.Base={extend:function(t){i.prototype=this;var e=new i;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||c).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes;if(t=t.sigBytes,this.clamp(),r%4)for(var i=0;i<t;i++)e[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<t;i+=4)e[r+i>>>2]=n[i>>>2];else e.push.apply(e,n);return this.sigBytes+=t,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n=[],r=0;r<e;r+=4)n.push(4294967296*t.random()|0);return new o.init(n,e)}}),s=n.enc={},c=s.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],r=0;r<t;r++){var i=e[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new o.init(n,e/2)}},u=s.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var n=[],r=0;r<t;r++)n.push(String.fromCharCode(e[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new o.init(n,e)}},d=s.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},l=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=d.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a),s=e?t.ceil(s):t.max((0|s)-this._minBufferSize,0);if(e=s*a,i=t.min(4*e,i),e){for(var c=0;c<e;c+=a)this._doProcessBlock(r,c);c=r.splice(0,e),n.sigBytes-=i}return new o.init(c,i)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});r.Hasher=l.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new p.HMAC.init(t,n).finalize(e)}}});var p=n.algo={};return n}(Math);!function(t){for(var e=r,n=e.lib,i=n.WordArray,a=n.Hasher,n=e.algo,o=[],s=[],c=function(t){return 4294967296*(t-(0|t))|0},u=2,d=0;64>d;){var l;t:{l=u;for(var p=t.sqrt(l),f=2;f<=p;f++)if(!(l%f)){l=!1;break t}l=!0}l&&(8>d&&(o[d]=c(t.pow(u,.5))),s[d]=c(t.pow(u,1/3)),d++),u++}var h=[],n=n.SHA256=a.extend({_doReset:function(){this._hash=new i.init(o.slice(0))},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],i=n[1],a=n[2],o=n[3],c=n[4],u=n[5],d=n[6],l=n[7],p=0;64>p;p++){if(16>p)h[p]=0|t[e+p];else{var f=h[p-15],g=h[p-2];h[p]=((f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3)+h[p-7]+((g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10)+h[p-16]}f=l+((c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25))+(c&u^~c&d)+s[p]+h[p],g=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&a^i&a),l=d,d=u,u=c,c=o+f|0,o=a,a=i,i=r,r=f+g|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+a|0,n[3]=n[3]+o|0,n[4]=n[4]+c|0,n[5]=n[5]+u|0,n[6]=n[6]+d|0,n[7]=n[7]+l|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,i=8*e.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=t.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,e.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var t=a.clone.call(this);return t._hash=this._hash.clone(),t}});e.SHA256=a._createHelper(n),e.HmacSHA256=a._createHmacHelper(n)}(Math),function(){var t=r,e=t.enc.Utf8;t.algo.HMAC=t.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,"string"==typeof n&&(n=e.parse(n));var r=t.blockSize,i=4*r;n.sigBytes>i&&(n=t.finalize(n)),n.clamp();for(var a=this._oKey=n.clone(),o=this._iKey=n.clone(),s=a.words,c=o.words,u=0;u<r;u++)s[u]^=1549556828,c[u]^=909522486;a.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher;return t=e.finalize(t),e.reset(),e.finalize(this._oKey.clone().concat(t))}})}(),e.a=r},function(t,e,n){"use strict";e.a={name:"loading",props:{color:{type:String,default:"#333"}}}},function(t,e,n){"use strict";e.a={name:"recording-icon",props:{color:{type:String,default:"#333"}}}},function(t,e,n){"use strict";e.a={name:"microphone",props:{color:{type:String,default:"#333"}}}},function(t,e,n){"use strict";e.a={name:"recording-tip",props:{position:{type:String,default:"top"}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(11);r.a.install=function(t,e){t.prototype.IATConfig=e,t.component(r.a.name,r.a)},"undefined"!=typeof window&&window.Vue&&window.Vue.use(r.a),e.default=r.a},function(t,e,n){"use strict";function r(t){n(12)}var i=n(3),a=n(35),o=n(2),s=r,c=o(i.a,a.a,!1,s,"data-v-0088927a",null);e.a=c.exports},function(t,e,n){var r=n(13);"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);n(1)("01101ff4",r,!0,{})},function(t,e,n){e=t.exports=n(0)(!1),e.push([t.i,".voice-input-button[data-v-0088927a]{position:relative;width:100%;height:100%;display:flex;justify-content:center;align-items:center;opacity:.5}.voice-input-button.ready[data-v-0088927a]{opacity:1}.voice-input-button .record-btn[data-v-0088927a]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;cursor:pointer}.voice-input-button .record-btn.disabled[data-v-0088927a]{pointer-events:none;cursor:not-allowed}.voice-input-button .record-btn>[data-v-0088927a]{pointer-events:none}.loader[data-v-0088927a]{display:inline-block;margin:0 5px}.pop[data-v-0088927a]{position:fixed;top:0;bottom:0;left:0;right:0;margin:auto;width:40%;height:100px;display:flex;justify-content:center;align-items:center;background-color:rgba(0,0,0,.5);pointer-events:none;opacity:0;transition:opacity .1s}.pop.recording[data-v-0088927a]{opacity:1}.fade-enter-active[data-v-0088927a],.fade-leave-active[data-v-0088927a]{transition:opacity .3s}.fade-enter[data-v-0088927a],.fade-leave-to[data-v-0088927a]{opacity:0}",""])},function(t,e){t.exports=function(t,e){for(var n=[],r={},i=0;i<e.length;i++){var a=e[i],o=a[0],s=a[1],c=a[2],u=a[3],d={id:t+":"+i,css:s,media:c,sourceMap:u};r[o]?r[o].parts.push(d):n.push(r[o]={id:o,parts:[d]})}return n}},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var a=n(5),o=(n(16),n(17)),s=n(18),c=n(4),u=n.n(c),d=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=Object(s.a)(o.a),p=[],f=window.AudioContext||window.webkitAudioContext;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,l.onmessage=function(t){p.push.apply(p,i(t.data.buffer))};var h=function(){function t(e){r(this,t),this.config=e,this.state="end",this.language=e.language||"zh_cn",this.accent=e.accent||"mandarin",this.appId=e.appId,this.apiKey=e.apiKey,this.apiSecret=e.apiSecret,this.isAudioAvailable=!!(navigator.getUserMedia&&f&&l),this.pd=e.pd,this.rlang=e.rlang,this.ptt=e.ptt,this.nunum=e.nunum,this.vad_eos=e.vad_eos}return d(t,[{key:"start",value:function(){var t=this;if(this.stop(),navigator.getUserMedia&&f)if(this.state="init",this.recorder)this.connectWebsocket();else{if(!this.context){var e=new f;this.context=e}this.recorder=this.context.createScriptProcessor(0,1,1);var n=function(e){var n=t.context.createMediaStreamSource(e);t.mediaStream=n,t.recorder.onaudioprocess=function(e){t.sendData(e.inputBuffer.getChannelData(0))},t.connectWebsocket()},r=function(e){t.recorder=null,t.mediaStream=null,t.context=null,console.warn(e.message||u.a[t.language].access_microphone_failed)};navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(t){n(t)}).catch(function(t){r(t)}):navigator.getUserMedia({audio:!0,video:!1},function(t){n(t)},function(t){r(t)})}else alert(u.a[this.language].not_supported)}},{key:"stop",value:function(){this.state="end";try{this.recorder&&(this.mediaStream.disconnect(this.recorder),this.recorder.disconnect(),this.recorder=null),this.mediaStream&&this.mediaStream.mediaStream.getTracks().forEach(function(t){t.stop()})}catch(t){console.warn(t.message)}}},{key:"sendData",value:function(t){l.postMessage({command:"transform",buffer:t})}},{key:"connectWebsocket",value:function(){var t=this,e="iat-api.xfyun.cn",n=this.apiKey,r=this.apiSecret,i=(new Date).toGMTString(),o="host: "+e+"\ndate: "+i+"\nGET /v2/iat HTTP/1.1",s=a.a.HmacSHA256(o,r),c=a.a.enc.Base64.stringify(s),d='api_key="'+n+'", algorithm="hmac-sha256", headers="host date request-line", signature="'+c+'"',l=btoa(d),p="wss://iat-api.xfyun.cn/v2/iat?authorization="+l+"&date="+i+"&host="+e;if("WebSocket"in window)this.ws=new WebSocket(p);else{if(!("MozWebSocket"in window))return alert(u.a[this.language].not_supported),null;this.ws=new MozWebSocket(p)}this.ws.onopen=function(e){t.mediaStream.connect(t.recorder),t.recorder.connect(t.context.destination),t.state="ready",setTimeout(function(){t.wsOpened(e)},100),t.config.onStart&&t.config.onStart(e)},this.ws.onmessage=function(e){t.config.onMessage&&t.config.onMessage(e),t.wsOnMessage(e)},this.ws.onerror=function(e){t.stop(),t.config.onError&&t.config.onError(e)},this.ws.onclose=function(e){t.stop(),t.config.onClose&&t.config.onClose(e)}}},{key:"wsOpened",value:function(){var t=this;if(1===this.ws.readyState){this.state="ing";var e=p.splice(0,1280),n={common:{app_id:this.appId},business:{language:this.language,domain:"iat",accent:this.accent,vad_eos:this.vad_eos,dwa:"wpgs",pd:this.pd,rlang:this.rlang,ptt:this.ptt,nunum:this.nunum},data:{status:0,format:"audio/L16;rate=16000",encoding:"raw",audio:this.ArrayBufferToBase64(e)}};this.ws.send(JSON.stringify(n)),this.handlerInterval=setInterval(function(){if(1!==t.ws.readyState)return void clearInterval(t.handlerInterval);if(0===p.length)return"end"===t.state&&(t.ws.send(JSON.stringify({data:{status:2,format:"audio/L16;rate=16000",encoding:"raw",audio:""}})),clearInterval(t.handlerInterval)),!1;var e=p.splice(0,1280);t.ws.send(JSON.stringify({data:{status:1,format:"audio/L16;rate=16000",encoding:"raw",audio:t.ArrayBufferToBase64(e)}}))},40)}}},{key:"wsOnMessage",value:function(t){var e=JSON.parse(t.data);0===e.code&&2===e.data.status&&this.ws.close(),0!==e.code&&(this.ws.close(),console.log(e.code+":"+e.message))}},{key:"ArrayBufferToBase64",value:function(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return window.btoa(e)}}]),t}();e.a=h},function(t,e,n){"use strict";var r=n(5);!function(){var t=r.a,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,n=t.sigBytes,r=this._map;t.clamp(),t=[];for(var i=0;i<n;i+=3)for(var a=(e[i>>>2]>>>24-i%4*8&255)<<16|(e[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|e[i+2>>>2]>>>24-(i+2)%4*8&255,o=0;4>o&&i+.75*o<n;o++)t.push(r.charAt(a>>>6*(3-o)&63));if(e=r.charAt(64))for(;t.length%4;)t.push(e);return t.join("")},parse:function(t){var n=t.length,r=this._map,i=r.charAt(64);i&&-1!=(i=t.indexOf(i))&&(n=i);for(var i=[],a=0,o=0;o<n;o++)if(o%4){var s=r.indexOf(t.charAt(o-1))<<o%4*2,c=r.indexOf(t.charAt(o))>>>6-o%4*2;i[a>>>2]|=(s|c)<<24-a%4*8,a++}return e.create(i,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}()},function(t,e,n){"use strict";var r=function(){var t=this;this.onmessage=function(t){switch(t.data.command){case"transform":e.transaction(t.data.buffer)}};var e={transaction:function(n){var r=e.to16kHz(n),i=e.to16BitPCM(r);t.postMessage({buffer:i})},to16kHz:function(t){var e=new Float32Array(t),n=Math.round(e.length*(16e3/44100)),r=new Float32Array(n),i=(e.length-1)/(n-1);r[0]=e[0];for(var a=1;a<n-1;a++){var o=a*i,s=Math.floor(o).toFixed(),c=Math.ceil(o).toFixed(),u=o-s;r[a]=e[s]+(e[c]-e[s])*u}return r[n-1]=e[e.length-1],r},to16BitPCM:function(t){for(var e=2*t.length,n=new ArrayBuffer(e),r=new DataView(n),i=0,a=0;a<t.length;a++,i+=2){var o=Math.max(-1,Math.min(1,t[a]));r.setInt16(i,o<0?32768*o:32767*o,!0)}return Array.from(new Int8Array(r.buffer))},toBase64:function(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return window.btoa(e)}}};e.a=r},function(t,e,n){"use strict";var r=function(t){var e=t.toString();e=e.substr(e.indexOf("{")+1),e=e.substr(0,e.lastIndexOf("}"));var n=new Blob([e]),r=URL.createObjectURL(n),i=new Worker(r);return URL.revokeObjectURL(r),i};e.a=r},function(t,e,n){"use strict";function r(t){n(20)}var i=n(6),a=n(22),o=n(2),s=r,c=o(i.a,a.a,!1,s,"data-v-2ceebd6a",null);e.a=c.exports},function(t,e,n){var r=n(21);"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);n(1)("426a9a8b",r,!0,{})},function(t,e,n){e=t.exports=n(0)(!1),e.push([t.i,".loader[data-v-2ceebd6a]{width:20px;height:20px;margin:auto}",""])},function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"loader",attrs:{title:"loading…"}},[n("svg",{staticStyle:{"enable-background":"new 0 0 50 50"},attrs:{version:"1.1",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"20px",height:"20px",viewBox:"0 0 20 20","xml:space":"preserve"}},[n("rect",{attrs:{x:"0",y:"0",width:"4",height:"20",fill:t.color}},[n("animate",{attrs:{attributeName:"opacity",attributeType:"XML",values:"1; .2; 1",begin:"0s",dur:"0.6s",repeatCount:"indefinite"}})]),t._v(" "),n("rect",{attrs:{x:"7",y:"0",width:"4",height:"20",fill:t.color}},[n("animate",{attrs:{attributeName:"opacity",attributeType:"XML",values:"1; .2; 1",begin:"0.2s",dur:"0.6s",repeatCount:"indefinite"}})]),t._v(" "),n("rect",{attrs:{x:"14",y:"0",width:"4",height:"20",fill:t.color}},[n("animate",{attrs:{attributeName:"opacity",attributeType:"XML",values:"1; .2; 1",begin:"0.4s",dur:"0.6s",repeatCount:"indefinite"}})])])])},i=[],a={render:r,staticRenderFns:i};e.a=a},function(t,e,n){"use strict";function r(t){n(24)}var i=n(7),a=n(26),o=n(2),s=r,c=o(i.a,a.a,!1,s,"data-v-7e985a13",null);e.a=c.exports},function(t,e,n){var r=n(25);"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);n(1)("4a5c0c14",r,!0,{})},function(t,e,n){e=t.exports=n(0)(!1),e.push([t.i,".recording[data-v-7e985a13]{width:20px;height:20px;margin:auto}",""])},function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"recording",attrs:{title:"recording…"}},[n("svg",{staticStyle:{"enable-background":"new 0 0 50 50"},attrs:{version:"1.1",id:"Layer_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",width:"20px",height:"20px",viewBox:"0 0 20 20","xml:space":"preserve"}},[n("rect",{attrs:{x:"0",y:"8",width:"4",height:"4",fill:t.color}},[n("animate",{attrs:{attributeName:"height",attributeType:"XML",values:"4;20;4",begin:"0s",dur:"0.6s",repeatCount:"indefinite"}}),t._v(" "),n("animate",{attrs:{attributeName:"y",attributeType:"XML",values:"8; 0; 8",begin:"0s",dur:"0.6s",repeatCount:"indefinite"}})]),t._v(" "),n("rect",{attrs:{x:"7",y:"8",width:"4",height:"4",fill:t.color}},[n("animate",{attrs:{attributeName:"height",attributeType:"XML",values:"4;20;4",begin:"0.15s",dur:"0.6s",repeatCount:"indefinite"}}),t._v(" "),n("animate",{attrs:{attributeName:"y",attributeType:"XML",values:"8; 0; 8",begin:"0.15s",dur:"0.6s",repeatCount:"indefinite"}})]),t._v(" "),n("rect",{attrs:{x:"14",y:"8",width:"4",height:"4",fill:t.color}},[n("animate",{attrs:{attributeName:"height",attributeType:"XML",values:"4;20;4",begin:"0.3s",dur:"0.6s",repeatCount:"indefinite"}}),t._v(" "),n("animate",{attrs:{attributeName:"y",attributeType:"XML",values:"8; 0; 8",begin:"0.3s",dur:"0.6s",repeatCount:"indefinite"}})])])])},i=[],a={render:r,staticRenderFns:i};e.a=a},function(t,e,n){"use strict";function r(t){n(28)}var i=n(8),a=n(30),o=n(2),s=r,c=o(i.a,a.a,!1,s,"data-v-695bba78",null);e.a=c.exports},function(t,e,n){var r=n(29);"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);n(1)("e94d9a2a",r,!0,{})},function(t,e,n){e=t.exports=n(0)(!1),e.push([t.i,".microphone[data-v-695bba78]{width:32px;height:32px;margin:auto}",""])},function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"microphone",attrs:{title:"录音"}},[n("svg",{staticClass:"icon",attrs:{t:"1543917784414",fill:t.color,viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2028","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"32",height:"32"}},[n("path",{attrs:{d:"M512 608 512 608c88 0 160-72 160-160L672 256c0-88-72-160-160-160l0 0c-88 0-160 72-160 160l0 192C352 536 424 608 512 608zM796.6 492.4c2.7-17.5-9.2-33.8-26.7-36.5-17.5-2.6-33.8 9.3-36.5 26.7C716.6 590.6 621.5 672 512 672c-109.5 0-204.7-81.5-221.4-189.5-2.7-17.5-19.1-29.4-36.5-26.7-17.5 2.7-29.4 19-26.7 36.5 20.2 130.5 124 227.8 252.6 241.8L480 832l-96 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l256 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0 0-97.9C672.5 720.1 776.4 622.9 796.6 492.4z","p-id":"2029"}})])])},i=[],a={render:r,staticRenderFns:i};e.a=a},function(t,e,n){"use strict";function r(t){n(32)}var i=n(9),a=n(34),o=n(2),s=r,c=o(i.a,a.a,!1,s,"data-v-167a5f88",null);e.a=c.exports},function(t,e,n){var r=n(33);"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);n(1)("35dd9357",r,!0,{})},function(t,e,n){e=t.exports=n(0)(!1),e.push([t.i,'.recording-tip[data-v-167a5f88]{position:absolute;width:auto;max-width:270px;display:flex;justify-content:flex-end;white-space:nowrap;padding:0;border-radius:3px;background-color:#4b667d;box-shadow:0 2px 2px rgba(0,0,0,.1);color:#f2f2f2;pointer-events:none;overflow:hidden;border-width:2px 15px 3px;border-style:solid;border-color:#4b667d}.recording-tip[data-v-167a5f88]:before{position:absolute;margin:auto;content:" ";width:10px;height:10px;background-color:inherit}.recording-tip.top[data-v-167a5f88]{bottom:calc(100% + 5px);left:50%;transform:translate3d(-50%,0,0)}.recording-tip.top[data-v-167a5f88]:before{bottom:-5px;left:0;right:0;clip-path:polygon(0 50%,50% 100%,100% 50%)}.recording-tip.right[data-v-167a5f88]{left:calc(100% + 5px);top:50%;transform:translate3d(0,-50%,0)}.recording-tip.right[data-v-167a5f88]:before{left:-5px;top:0;bottom:0;clip-path:polygon(0 50%,50% 100%,50% 0)}.recording-tip.bottom[data-v-167a5f88]{top:calc(100% + 5px);left:50%;transform:translate3d(-50%,0,0)}.recording-tip.bottom[data-v-167a5f88]:before{top:-5px;left:0;right:0;clip-path:polygon(0 50%,50% 0,100% 50%)}.recording-tip.left[data-v-167a5f88]{right:calc(100% + 5px);top:50%;transform:translate3d(0,-50%,0)}.recording-tip.left[data-v-167a5f88]:before{right:-5px;top:0;bottom:0;clip-path:polygon(100% 50%,50% 100%,50% 0)}',""])},function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"recording-tip",class:t.position},[t._t("default")],2)},i=[],a={render:r,staticRenderFns:i};e.a=a},function(t,e,n){"use strict";var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"voice-input-button",class:{active:t.recording,ready:t.isAudioAvailable}},[n("div",{staticClass:"record-btn",on:{contextmenu:t.menuPop,mousedown:function(e){t.pressMode?t.start(e):t.toggle(e)},mouseup:function(e){t.pressMode&&t.stop(e)},mouseleave:function(e){t.pressMode&&t.stop(e)},touchstart:function(e){t.pressMode?t.start(e):t.toggle(e)},touchend:function(e){t.pressMode&&t.stop(e)},touchleave:function(e){t.pressMode&&t.stop(e)}}},[t.recording?"ing"===t.state||t.responding||t.result?n("recording-icon",{attrs:{color:t.color}}):n("loading",{attrs:{color:t.color}}):n("microphone",{attrs:{color:t.color}}),t._v(" "),n("transition",{attrs:{name:"fade"}},["ing"===t.state||t.responding||t.result?n("recording-tip",{attrs:{position:t.tipPosition}},[t._t("recording",[t._v(t._s(t.result||t.locale.recording))])],2):t._e(),t._v(" "),"init"===t.state?n("recording-tip",{attrs:{position:t.tipPosition}},[t._t("wait",[t._v(t._s(t.locale.wait))])],2):t._e(),t._v(" "),t.blank?n("recording-tip",{attrs:{position:t.tipPosition}},[t._t("no-speak",[t._v(t._s(t.locale.say_nothing))])],2):t._e()],1)],1)])},i=[],a={render:r,staticRenderFns:i};e.a=a}])});
//# sourceMappingURL=voice-input-button.js.map